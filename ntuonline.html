<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ntudioka Admin</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://apis.google.com/js/api.js"></script>
    <script src="https://accounts.google.com/gsi/client"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', sans-serif;
        }
        body {
            background: linear-gradient(135deg, #0b0c10 0%, #1a1f2e 100%);
            color: #e0e0e0;
            min-height: 100vh;
        }
        .glass {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.4);
        }
        .public-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 5%;
            background: rgba(10, 15, 20, 0.8);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid #00ffff33;
            position: sticky;
            top: 0;
            z-index: 50;
        }
        .logo {
            font-size: 2rem;
            font-weight: 700;
            background: linear-gradient(45deg, #00ffff, #ff00ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .btn-outline {
            background: transparent;
            border: 1px solid #00ffff;
            color: #00ffff;
            padding: 8px 25px;
            border-radius: 40px;
            font-weight: 600;
            cursor: pointer;
            transition: 0.3s;
        }
        .btn-outline:hover {
            background: #00ffff22;
        }
        #admin-login-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9);
            backdrop-filter: blur(15px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        .login-card {
            width: 350px;
            padding: 40px;
            background: rgba(20, 30, 50, 0.9);
            border: 1px solid #00ffff;
            border-radius: 30px;
            box-shadow: 0 0 50px #00ffff33;
        }
        .login-card h2 {
            text-align: center;
            margin-bottom: 30px;
            color: #00ffff;
        }
        .login-card input {
            width: 100%;
            padding: 15px;
            margin-bottom: 20px;
            background: rgba(255,255,255,0.1);
            border: 1px solid #444;
            border-radius: 40px;
            color: white;
            font-size: 1rem;
        }
        .login-card button {
            width: 100%;
            padding: 15px;
            background: linear-gradient(45deg, #00ffff, #ff00ff);
            border: none;
            border-radius: 40px;
            font-weight: bold;
            font-size: 1.2rem;
            cursor: pointer;
            transition: 0.3s;
        }
        .login-card button:hover {
            transform: scale(1.05);
            box-shadow: 0 0 20px #00ffff;
        }
        .reset-link {
            text-align: center;
            margin-top: 15px;
            font-size: 0.9rem;
        }
        .reset-link a {
            color: #00ffff;
            text-decoration: none;
            cursor: pointer;
        }
        .reset-link a:hover {
            text-decoration: underline;
        }
        #admin-dashboard {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: #0a0c14;
            z-index: 2000;
            overflow-y: auto;
        }
        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 30px;
            background: #10131f;
            border-bottom: 1px solid #00ffff33;
        }
        .dashboard-header h1 {
            font-size: 2rem;
            background: linear-gradient(45deg, #00ffff, #ff00ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .dashboard-nav {
            display: flex;
            gap: 20px;
            background: #1a1e2f;
            padding: 15px 30px;
        }
        .dashboard-nav button {
            background: transparent;
            border: none;
            color: #aaa;
            font-size: 1.1rem;
            padding: 10px 20px;
            border-radius: 40px;
            cursor: pointer;
            transition: 0.3s;
        }
        .dashboard-nav button.active {
            background: #00ffff22;
            color: #00ffff;
            border: 1px solid #00ffff;
        }
        .dashboard-content {
            padding: 30px;
        }
        .card {
            background: rgba(255,255,255,0.03);
            border: 1px solid #2a2e45;
            border-radius: 30px;
            padding: 25px;
            margin-bottom: 30px;
        }
        .form-group {
            margin-bottom: 20px;
        }
        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #00ffff;
        }
        .form-control {
            width: 100%;
            padding: 15px;
            background: #1e2335;
            border: 1px solid #3a4055;
            border-radius: 40px;
            color: white;
        }
        textarea.form-control {
            border-radius: 20px;
        }
        .btn {
            background: linear-gradient(45deg, #00ffff, #ff00ff);
            border: none;
            padding: 12px 30px;
            border-radius: 40px;
            font-weight: bold;
            cursor: pointer;
            transition: 0.3s;
            margin-right: 10px;
        }
        .btn-outline {
            background: transparent;
            border: 1px solid #00ffff;
            color: #00ffff;
        }
        .episode-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            background: #1a1f30;
            border-radius: 50px;
            margin-bottom: 10px;
        }
        .status-badge {
            background: #00ffaa22;
            color: #00ffaa;
            padding: 4px 12px;
            border-radius: 40px;
            font-size: 0.8rem;
        }
        .hidden {
            display: none !important;
        }
        .error-message {
            color: #ff4d4d;
            margin-top: 10px;
        }
        .success-message {
            color: #00ffaa;
        }
    </style>
</head>
<body>
    <!-- Public Header (visible when not logged in) -->
    <div id="public-site" style="display: block;">
        <header class="public-header">
            <div class="logo">Ntudioka Online</div>
            <div>
                <button onclick="showLogin()" class="btn-outline">Admin</button>
            </div>
        </header>
        <main style="padding: 40px; text-align: center;">
            <h1 style="color: #00ffff;">üéôÔ∏è Admin Dashboard</h1>
            <p style="margin-top: 20px;">Click "Admin" to log in and manage episodes.</p>
        </main>
    </div>

    <!-- Admin Login Overlay -->
    <div id="admin-login-overlay">
        <div class="login-card">
            <h2><i class="fas fa-microphone-alt"></i> Admin Access</h2>
            <input type="text" id="login-username" placeholder="Username" value="Admin">
            <input type="password" id="login-password" placeholder="Password">
            <button onclick="attemptLogin()">Enter</button>
            <div id="login-error" class="error-message" style="text-align: center;"></div>
            <div class="reset-link">
                <a onclick="resetPassword()">üîë Reset password to default (admin123)</a>
            </div>
        </div>
    </div>

    <!-- Admin Dashboard -->
    <div id="admin-dashboard">
        <div class="dashboard-header">
            <h1>‚ö° Ntudioka Command Center</h1>
            <div>
                <span id="admin-welcome"></span>
                <button onclick="logout()" class="btn-outline" style="margin-left: 20px;">Logout</button>
            </div>
        </div>
        <div class="dashboard-nav">
            <button id="nav-episodes" class="active" onclick="switchTab('episodes')">üìª Episodes</button>
            <button id="nav-settings" onclick="switchTab('settings')">‚öôÔ∏è Settings</button>
        </div>
        <div class="dashboard-content">
            <!-- Episodes Tab -->
            <div id="tab-episodes">
                <div class="card">
                    <h2 style="color:#00ffff; margin-bottom:20px;">‚ûï Add New Episode</h2>
                    <div class="form-group">
                        <label>Episode Title</label>
                        <input type="text" id="episode-title" class="form-control" placeholder="e.g. Ep 13: Future Frequencies">
                    </div>
                    <div class="form-group">
                        <label>Description</label>
                        <textarea id="episode-desc" class="form-control" rows="3" placeholder="Short summary..."></textarea>
                    </div>
                    <div class="form-group">
                        <label>Upload Audio (MP3, WAV)</label>
                        <input type="file" id="audio-file" accept="audio/*" class="form-control">
                        <div style="margin-top:10px; color:#aaa; font-size:0.9rem;">
                            <i class="fab fa-google-drive"></i> File will be stored in Google Drive and made public.
                        </div>
                    </div>
                    <button onclick="uploadEpisode()" class="btn">Publish Episode</button>
                    <div id="upload-status"></div>
                </div>
                <!-- Optional: List of episodes (could be added but not necessary) -->
            </div>

            <!-- Settings Tab -->
            <div id="tab-settings" class="hidden">
                <div class="card">
                    <h2 style="color:#00ffff; margin-bottom:20px;">üîê Change Admin Password</h2>
                    <div class="form-group">
                        <label>Current Password</label>
                        <input type="password" id="current-password" class="form-control">
                    </div>
                    <div class="form-group">
                        <label>New Password</label>
                        <input type="password" id="new-password" class="form-control">
                    </div>
                    <div class="form-group">
                        <label>Confirm New Password</label>
                        <input type="password" id="confirm-password" class="form-control">
                    </div>
                    <button onclick="changePassword()" class="btn">Update Password</button>
                    <div id="password-message"></div>
                </div>
                <div class="card">
                    <h2 style="color:#00ffff; margin-bottom:20px;">‚òÅÔ∏è Google Drive Status</h2>
                    <p>Using configured credentials:</p>
                    <p><strong>Client ID:</strong>198496607352-o73mou51uhqsq2ht1t6en0c8tn6dmlm8.apps.googleusercontent.com</p>
                    <p><strong>API Key:</strong>AIzaSyD0_olSxyD5APZKaE-Ggl6SvvJm_HT3f20</p>
                    <p><strong>Folder ID:</strong> <span id="folder-id-display">https://drive.google.com/drive/folders/1myE1BYa3su07OquibN5g6h1fvGmN-2kN?dmr=1&ec=wgc-drive-%5Bmodule%5D-goto</span> (replace in code)</p>
                    <p id="drive-status">Status: <span style="color:#00ffaa;">‚úÖ Ready</span></p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ========== CONFIGURATION ==========
        const CLIENT_ID = '198496607352-o73mou51uhqsq2ht1t6en0c8tn6dmlm8.apps.googleusercontent.com';
        const API_KEY = 'AIzaSyD0_olSxyD5APZKaE-Ggl6SvvJm_HT3f20';
        const FOLDER_ID = 'https://drive.google.com/drive/folders/1myE1BYa3su07OquibN5g6h1fvGmN-2kN?dmr=1&ec=wgc-drive-%5Bmodule%5D-goto'; // <-- REPLACE WITH YOUR ACTUAL FOLDER ID
        const SCOPES = 'https://www.googleapis.com/auth/drive.file';

        // ========== DATA (only admin password stored locally) ==========
        let data = { adminPassword: 'admin123' };
        function loadData() {
            const stored = localStorage.getItem('ntudiokaAdmin');
            if (stored) {
                try { data = JSON.parse(stored); }
                catch (e) { console.warn('Failed to parse admin data'); }
            }
            if (!data.adminPassword) data.adminPassword = 'admin123';
        }
        function saveData() { localStorage.setItem('ntudiokaAdmin', JSON.stringify(data)); }
        loadData();

        // ========== GOOGLE DRIVE AUTH ==========
        let accessToken = null;
        let tokenClient;

        function initGoogleDrive() {
            gapi.load('client', async () => {
                await gapi.client.init({ apiKey: API_KEY, discoveryDocs: ['https://www.googleapis.com/discovery/v1/apis/drive/v3/rest'] });
                console.log('GAPI ready');
            });
            tokenClient = google.accounts.oauth2.initTokenClient({
                client_id: CLIENT_ID,
                scope: SCOPES,
                callback: (resp) => {
                    if (resp.error) { console.error('Auth error', resp); return; }
                    accessToken = resp.access_token;
                    gapi.client.setToken({ access_token: accessToken });
                    document.getElementById('drive-status').innerHTML = 'Status: <span style="color:#00ffaa;">‚úÖ Authenticated</span>';
                },
            });
        }

        function authenticateDrive() {
            return new Promise((resolve, reject) => {
                tokenClient.callback = (resp) => {
                    if (resp.error) reject(resp);
                    else { accessToken = resp.access_token; gapi.client.setToken({ access_token: accessToken }); resolve(accessToken); }
                };
                tokenClient.requestAccessToken({ prompt: 'consent' });
            });
        }

        async function ensureAuthenticated() {
            if (accessToken) return accessToken;
            return await authenticateDrive();
        }

        // ========== UPLOAD EPISODE ==========
        async function uploadEpisode() {
            const title = document.getElementById('episode-title').value.trim();
            const desc = document.getElementById('episode-desc').value.trim();
            const fileInput = document.getElementById('audio-file');
            const file = fileInput.files[0];
            if (!title || !desc || !file) {
                document.getElementById('upload-status').innerHTML = '<span style="color:#ff4d4d;">All fields required</span>';
                return;
            }
            document.getElementById('upload-status').innerHTML = '<span style="color:#00ffaa;">‚è≥ Uploading to Drive...</span>';

            try {
                await ensureAuthenticated();

                // Upload file to the public folder with metadata in description
                const metadata = {
                    name: file.name,
                    mimeType: file.type,
                    parents: [FOLDER_ID],
                    description: JSON.stringify({ title, desc })
                };
                const form = new FormData();
                form.append('metadata', new Blob([JSON.stringify(metadata)], { type: 'application/json' }));
                form.append('file', file);

                const response = await fetch('https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart', {
                    method: 'POST',
                    headers: { Authorization: 'Bearer ' + accessToken },
                    body: form
                });
                const fileData = await response.json();
                const fileId = fileData.id;

                // Make file public
                await fetch(`https://www.googleapis.com/drive/v3/files/${fileId}/permissions`, {
                    method: 'POST',
                    headers: {
                        Authorization: 'Bearer ' + accessToken,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ role: 'reader', type: 'anyone' })
                });

                document.getElementById('upload-status').innerHTML = '<span style="color:#00ffaa;">‚úÖ Episode published!</span>';
                document.getElementById('episode-title').value = '';
                document.getElementById('episode-desc').value = '';
                fileInput.value = '';
            } catch (err) {
                console.error(err);
                document.getElementById('upload-status').innerHTML = '<span style="color:#ff4d4d;">Upload failed. Check console.</span>';
            }
        }

        // ========== ADMIN LOGIN ==========
        function showLogin() {
            document.getElementById('admin-login-overlay').style.display = 'flex';
        }

        function attemptLogin() {
            const username = document.getElementById('login-username').value.trim();
            const password = document.getElementById('login-password').value.trim();
            if (username.toLowerCase() === 'admin' && password === data.adminPassword) {
                document.getElementById('admin-login-overlay').style.display = 'none';
                document.getElementById('public-site').style.display = 'none';
                document.getElementById('admin-dashboard').style.display = 'block';
                authenticateDrive().catch(() => {});
                document.getElementById('login-error').innerText = '';
            } else {
                document.getElementById('login-error').innerText = 'Invalid credentials';
            }
        }

        function resetPassword() {
            if (confirm('Reset admin password to default (admin123)?')) {
                data.adminPassword = 'admin123';
                saveData();
                document.getElementById('login-error').innerHTML = '<span style="color:#00ffaa;">Password reset to admin123</span>';
            }
        }

        function logout() {
            document.getElementById('admin-dashboard').style.display = 'none';
            document.getElementById('public-site').style.display = 'block';
            accessToken = null;
        }

        // ========== DASHBOARD TABS ==========
        function switchTab(tab) {
            document.getElementById('nav-episodes').classList.remove('active');
            document.getElementById('nav-settings').classList.remove('active');
            document.getElementById('tab-episodes').classList.add('hidden');
            document.getElementById('tab-settings').classList.add('hidden');
            if (tab === 'episodes') {
                document.getElementById('nav-episodes').classList.add('active');
                document.getElementById('tab-episodes').classList.remove('hidden');
            } else {
                document.getElementById('nav-settings').classList.add('active');
                document.getElementById('tab-settings').classList.remove('hidden');
            }
        }

        // ========== PASSWORD CHANGE ==========
        function changePassword() {
            const current = document.getElementById('current-password').value.trim();
            const newPass = document.getElementById('new-password').value.trim();
            const confirm = document.getElementById('confirm-password').value.trim();
            const msgDiv = document.getElementById('password-message');
            if (current !== data.adminPassword) { msgDiv.innerHTML = '<span style="color:#ff4d4d;">Current password incorrect</span>'; return; }
            if (newPass.length < 5) { msgDiv.innerHTML = '<span style="color:#ff4d4d;">New password too short</span>'; return; }
            if (newPass !== confirm) { msgDiv.innerHTML = '<span style="color:#ff4d4d;">Passwords do not match</span>'; return; }
            data.adminPassword = newPass;
            saveData();
            msgDiv.innerHTML = '<span style="color:#00ffaa;">‚úÖ Password updated</span>';
            document.getElementById('current-password').value = '';
            document.getElementById('new-password').value = '';
            document.getElementById('confirm-password').value = '';
        }

        // ========== INIT ==========
        initGoogleDrive();

        // Expose functions globally
        window.showLogin = showLogin;
        window.attemptLogin = attemptLogin;
        window.resetPassword = resetPassword;
        window.logout = logout;
        window.switchTab = switchTab;
        window.uploadEpisode = uploadEpisode;
        window.changePassword = changePassword;
    </script>
</body>
</html>
